---
- name: Disable swap
  shell: |
    swapoff -a

- name: Disable SWAP in fstab
  replace:
    path: /etc/fstab
    regexp: '^(.+?\sswap\s+sw\s+.*)$'
    replace: '# \1'

- name: Enable IP Forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: 1
    sysctl_file: "/etc/sysctl.d/99-openshift.conf"
    reload: yes

- name: package epel-release upgrade
  yum:
    name:
      - epel-release

- name: Install required system packages
  yum:
    name:
      - wget
      - git
      - zile
      - nano
      - net-tools
      - docker-1.13.1
      - bind-utils
      - iptables-services
      - bridge-utils
      - bash-completion
      - kexec-tools
      - sos
      - psacct
      - openssl-devel
      - httpd-tools
      - NetworkManager
      - python-cryptography
      - python2-pip
      - python-devel
      - python-passlib
      - java-1.8.0-openjdk-headless
      - "@Development Tools"
    state: present

- name: Insert docker INSECURE_REG line
  copy:
    src: daemon.json
    dest: /etc/docker/daemon.json
    mode: 0755
  notify:
    - restart docker

- name: restart docker
  service:
    name: docker
    state: restarted

- name: Disabling EPEL repo
  lineinfile:
    path: /etc/yum.repos.d/epel.repo
    regexp: "^enabled="
    line: enabled=0
- name: Enable and start Network MAnager
  systemd:
    name: NetworkManager
    enabled: yes
    state: started

- name: Install pyOpenSSL
  yum:
    name: pyOpenSSL
    enablerepo: "epel"

- name: Generating SSH Keygen
  command: 'ssh-keygen -q -f ~/.ssh/id_rsa -N ""'
  register: ssh_key

- name: Add ssh key to authorized keys
  command: "cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys"
  when: ssh_key is succeeded
